---
title: "Phase3"
author: "Karla Otoude and Chloé Marquis"
format:
  pdf: default
execute:
  echo: false
  warning: false
  message: false
---

#### Link to our github project 
[Our Github Project](https://github.com/chloemrq/Project-Data-Management)

# I. Research question 
**How are changes in health and social protection expenditures associated with avoidable mortality across OECD countries over time?**

Population health differs significantly across countries. One key factor explaining these differences is the strength of social and health protection systems. In particular, public investment in healthcare and social protection is expected to reduce mortality from causes that are considered preventable or treatable through effective public policies.

This report seeks to understand the relationship between social and health protection spending and avoidable mortality, used as an indicator of the effectiveness of a country's health system. Avoidable mortality captures premature deaths (under age 75) that could be prevented through healthcare, making it a relevant proxy for population health.

There are two goals in our analysis. First, using panel data for 41 OECD countries between 2000 and 2023, this report aims to describe and analyse the global evolution of avoidable mortality across OECD countries and assess if high levels of social and health spending are correlated with lower avoidable mortality rates. Second, it focuses on the Covid-19 crisis, to understand if countries with a stronger health protection pre-Covid experienced lower avoidable mortality rates from 2019 to 2021.

## Method 
To conduct our study we will be using a **linear mixed model (LMM)**. Lagged variables will be used as investments in both the social and health systems likely impact the population's general health with a delay. Such a model will allow us to properly study the OECD countries taking into account their differences. 

For explanatory variables, in order to estimate the strength and quality of a country’s health protection scheme, we will use the following variables: 

* Health expenditure 
* Social expenditure aggregates
* Number of hospitals beds

We also have more general variables such as :

* GDP per capita 
* Unemployment rate 
* Human development index 
* Life expectancy

They will be used as control variables, since richer countries tend to have better living conditions which may lead to a generally healthier population, without the need for a strong health protection. 

Finally, the explained variable will be : 

* Avoidable mortality 

 
```{r}
# Loading the packages
library(here)
here::i_am("Project-Data-Management.Rproj")
```


```{r}
library(ggplot2)
library(dplyr)
library(tidyr)
library(vroom)
library(readxl)
library(lme4)
```

# II. Description of the datasets
This report relies on 8 datasets. Here is a short description of each of them. More details on the datasets and their descriptive statistics can be found in Phase 2.

#### Health expenditure - OECD (2025)
This dataset details the annual health expenditure and financing as a percentage of GDP for 52 countries. The data is available for a period ranging from 2000 to 2024. It was computed using financial flows related to the consumption of healthcare goods and services from different health providers such as Hospitals or Residential long-term care facilities.  

### Avoidable mortality - OECD (2025)
This dataset describes the number of "avoidable deaths" per 100,000 inhabitants annually for the period 2000-2024 for 46 countries. It contains contains both “preventable mortality” and “treatable (or amenable) mortality”. The first refers to deaths that can be avoided through effective public health and primary prevention interventions. The second refers to timely and effective health care interventions, including prevention and treatment.Both indicators refer to premature mortality (under age 75).

### GDP per Capita - World Bank (2024)
The GDP per Capita dataset presents the GDP per capita (constant 2015 US$) from 1960 to 2024 for 70 countries. This indicator is expressed in constant prices, meaning the series has been adjusted to account for price changes over time. The reference year for this adjustment is 2015. This indicator is expressed in United States dollars. 

### Hospital beds - OECD (2025)
This dataset provides data on the number of total hospitals beds by function of healthcare and by type of care (ie. somatic or psychiatric care) for the period 2000-2024 for 48 different countries. Total hospital beds are the sum of the following categories: Curative care (acute care) beds in hospitals, Rehabilitative care beds in hospitals, Long-term care beds in hospitals, All other beds in hospitals not elsewhere classified. 

### Life expectancy - World Bank (2023)
This dataset provides the life expectancy in years for women and men for a period ranging from 1960 to 2023, for 69 different countries or economies. 

### Social Expenditure Aggregate - OECD (2025)
This dataset includes statistics on public and private social expenditure at program level (e.g. Old age, Survivors, Incapacity-related benefits, Health, etc) as a percentage of GDP. It covers 38 OECD countries for the period 1980-2021/23 and estimates for aggregates for 2022-24.

### Unemployement Rate - IMF (2025)
This IMF dataset describes the percentage of the labor force that is unemployed and actively seeking employment. It is available from 1980 to 2025 and features 120 geographic regions. 

### HDI (Human Development Index) - UNDP (2025)
This dataset describes the human development index, per country (195), annually (1990-2023). It is a summary measure of average achievement in key dimensions of human development: a long and healthy life, being knowledgeable and having a decent standard of living. The HDI is between 0 (low human development) and 1 (very high human development).




```{r}
# Loading the cleaned dataset from phase 2
database <- vroom(here("data", "cleaned_database.csv"))
```


```{r}
# Loading the raw datasets to create a brief description table
health_expenditure <- vroom(here("data", "OECD.ELS.HD,DSD_SHA@DF_SHA,1.0+.A.EXP_HEALTH.PT_B1GQ._T.._T.._T....csv"))

avoidable_mortality <- vroom(here("data", "OECD.ELS.HD,DSD_HEALTH_STAT@DF_AM,1.1+.A.AVM.DT_10P5HB.._T........csv"))

gdp_per_capita <- vroom(
  here("data/API_NY.GDP.PCAP.KD_DS2_en_csv_v2_242568", "API_NY.GDP.PCAP.KD_DS2_en_csv_v2_242568.csv"),
  delim = ",",
  skip = 4,           # need to skip the first 4 rows
  col_names = TRUE,   
)

hospital_beds <- vroom(here("data", "OECD.ELS.HD,DSD_HEALTH_REAC_HOSP@DF_BEDS_FUNC,1.0+..BD..._T._T...csv"))

life_expectancy <- vroom(
  here("data/API_SP.DYN.LE00.IN_DS2_fr_csv_v2_11258", "API_SP.DYN.LE00.IN_DS2_fr_csv_v2_11258.csv"), 
  delim = ",",
  skip = 4,           # need to skip the first 4 rows
  col_names = TRUE)

social_expenditure <- vroom(here("data","OECD.ELS.SPD,DSD_SOCX_AGG@DF_SOCX_AGG,1.0PT_B1GQ.ES10._T.csv"))

unemployment <- vroom(here("data", "dataset_2025-11-21T14_31_58.442440069Z_DEFAULT_INTEGRATION_IMF.RES_WEO_9.0.0.csv"))

hdi <- read_excel("data/hdr-data.xlsx")
```


```{r}
# Description table 
data_sets <- list(
  list(name = "Health Expenditure", data = health_expenditure),
  list(name = "Avoidable Mortality", data = avoidable_mortality),
  list(name = "GDP per Capita", data = gdp_per_capita),
  list(name = "Number of Hospital Beds", data = hospital_beds),
  list(name = "Life Expectancy", data = life_expectancy),
  list(name = "Social Expenditure", data = social_expenditure),
  list(name = "Unemployement", data = unemployment),
  list(name = "HDI", data = hdi)
)

get_summary <- function(dataset) {
  data <- dataset$data
  dataset_name <- dataset$name

  data.frame(
    Dataset = dataset_name,
    Observations = nrow(data),
    Variables = ncol(data)
  )
}

# Apply to all datasets
summary_list <- lapply(data_sets, get_summary)
summary_table <- do.call(rbind, summary_list)

# Display the table
knitr::kable(summary_table, caption = "Brief summary of the datasets used in this report")
```

## Description of the merged and cleaned dataset 
```{r}
database |> 
  summarise("Number of rows" = n(), 
            "Number of columns" = ncol(database),
            "Percentage of NA" = paste0(round(sum(is.na(database)) / (n() * ncol(database)) * 100, 2), "%"),
            "Number of countries studied" = n_distinct(REF_AREA), 
            "Time period" = paste0(min(TIME_PERIOD), "-", max(TIME_PERIOD))) |> 
  as.data.frame() |>
  knitr::kable()
```


# 3. Data Analysis 
We first start by a visual exploration of our main variable : avoidable mortality (*OBS_VALUE_mortality*) and its link to explanatory variables.

### Evolution of avoidable mortality per country
```{r}
average_trend <- database |>
  group_by(TIME_PERIOD) |>
  summarise(mean_mortality = mean(OBS_VALUE_mortality, na.rm = TRUE))

database |>
  ggplot(aes(x = TIME_PERIOD, y = OBS_VALUE_mortality, color=REF_AREA)) +
  geom_line() +
  geom_line(
    data = average_trend,
    aes(x = TIME_PERIOD, y = mean_mortality, color="OECD average"),
    color = "red",
    linewidth = 1.3
  ) +
  scale_x_continuous(breaks = c(2000, 2010, 2020)) +
  labs(
    x = "Year",
    y = "Number of avoidable deaths",
    caption = "Red line: OECD average",
    title = "Avoidable mortality per country (2000-2023), per 100,000 inhabitants annually")
```
Most countries share the same downward sloping trend in avoidable mortality. A distinct increase appears in 2019, with a peak in 2020 and a decrease to previous trend values from 2021 in all countries. 
The country with the lowest avoidable death rate is Switzerland (CHE) and the highest is Latvia at the beginning of the 2000s, then surpassed by Lithuania (LTU) around 2007. Additionally, there is a strong increase in avoidable deaths from around 400 to almost 650 per 100,000 inhabitants in Mexico in 2019. 

It is important to note that this report primarily studies developed countries with the most available data from 2000 to 2023. We chose to exclude the following countries : South Africa (ZAF), Argentina (ARG), Peru (PER), Thailand (THA) and Brazil (BRA) as the data was not sufficient to proceed with proper data analysis. Thus, our conclusions will be biased due to the fact that we study more developed countries with, perhaps, more similar institutional structures and resistance to global health crises such as Covid-19. 

### Visualising *avoidable_mortality* against independent variables
The goal of our analysis is to determine if the evolution of health and social expenditures are correlated with the evolution of avoidable mortality. We can start the data analysis by simply plotting some independent variables against *avoidable_mortality* and observe the general trend. 

```{r}
ggplot(database, aes(x = OBS_VALUE_health_exp, y = OBS_VALUE_mortality)) +
  geom_point(aes(color = REF_AREA)) +
  theme(legend.position = "right") +
  labs(
    x = "Health expenditure (as % of GDP)", 
    y = "Avoidable mortality",
    title = "Avoidable mortality against Health expenditure") +
  geom_smooth(method = "lm", se = FALSE) 
```

As expected, as the level of health expenditure increases, avoidable mortality tends to decrease. Australia (AUS) detaches itself from other countries by having a particularly high level of health expenditure, but still a moderately high level of avoidable mortality. Most countries are situated on the left side of the graph (with low health expenditure) showcasing countries with high and low rates of avoidable mortality for the same level of health expenditure. 

```{r}
ggplot(database, aes(x = OBS_VALUE_social_expenditure, y = OBS_VALUE_mortality)) +
  geom_point(aes(color = REF_AREA)) +
  theme(legend.position = "none") +
  labs(
    x = "Social expenditure (as % of GDP)", 
    y = "Avoidable mortality",
    title = "Avoidable mortality against Social Expenditure") +
  geom_smooth(method = "lm", se = FALSE)
```

As social expenditure increases, the avoidable mortality rate decreases. Most countries' social expenditure is within 10% and 25% of their GDP. However, for these countries similar in social expenditure levels, avoidable mortality goes from 100 to almost 700 per 100,000 deaths, suggesting an important variability. This observation is consistent with the trend observed using the health expenditure variable. Fro similar levels of health or social expenditure, avoidable mortality seems to vary significantly between countries.


```{r}
ggplot(database, aes(x = OBS_VALUE_unemp, y = OBS_VALUE_mortality)) +
  geom_point(aes(color = REF_AREA)) +
  theme(legend.position = "none") +
  labs(    
    x = "Unemployement", 
    y = "Avoidable mortality",
    title = "Avoidable mortality against Unemployment") +
  geom_smooth(method = "lm", se = FALSE)
```
Here, the trend indicates that as unemployment increases, avoidable mortality does too. Most countries have low levels of unemployment and low rates of avoidable mortality. 
In the bottom right, Spain (ESP) and Greece (GRC) display very high rates of unemployment while keeping their avoidable mortality rates among the lowest of all countries. On the contrary, countries such as Mexico (MEX) in purple showcase high levels of avoidable mortality with very low rates of unemployment. 

```{r}
ggplot(database, aes(x = OBS_VALUE_gdp, y = OBS_VALUE_mortality)) +
  geom_point(aes(color = REF_AREA)) +
  theme(legend.position = "none") +
  labs(
    x = "GDP per Capita", 
    y = "Avoidable mortality",
    title = "Avoidable mortality against GDP per Capita") +
  geom_smooth(method = "lm", se = FALSE)
```
This graph suggests that as GDP per capita increases, the rate of avoidable mortality decreases. The avoidable mortality rate doesn't seem to go below 100 deaths per 100,000 inhabitants. Thus, as GDP per capita increases, avoidable mortality remains between 100 and 300 deaths per 100,000 inhabitants suggesting marginal change in mortality as a country's population becomes richer.


# 4. Econometric Analysis : Linear Mixed Model (LMM)

## Correlation matrix for control variables 
```{r}
control_vars <- database |>
  select(OBS_VALUE_mortality, OBS_VALUE_gdp, OBS_VALUE_hdi, OBS_VALUE_life_exp, OBS_VALUE_unemp)

cor(control_vars) |>
  knitr::kable()
```
The correlation matrix reveals strong linear relationships among several control variables. 

* Avoidable mortality is highly negatively correlated with life expectancy (-0.96), reflecting the fact that both variables capture very similar aspects of general population health. 
* Life expectancy is also strongly correlated with HDI (0.76) and GDP per capita (0.65), meaning there is an overlap between these variables. 

In order to avoid multicollinearity issues in our regression, we choose to exclude HDI and life expectancy from our control variables. We retain GDP per capita and unemployment, which can adjust for differences in economic development between countries and remain sufficiently distinct from avoidable mortality. 

## Creating lag operators/ lagged variables

```{r}
data_lagged <- database |>
  group_by(REF_AREA) |>
  arrange(TIME_PERIOD) |>
  mutate(
    mortality_lag1 = lag(OBS_VALUE_mortality, 1),
    mortality_lag2 = lag(OBS_VALUE_mortality, 2),
    healthExp_lag1 = lag(OBS_VALUE_health_exp, 1),
    healthExp_lag2 = lag(OBS_VALUE_health_exp, 2),
    hospBeds_lag1 = lag(OBS_VALUE_hosp_beds, 1),
    hospBeds_lag2 = lag(OBS_VALUE_hosp_beds, 2),
    socialExp_lag1 = lag(OBS_VALUE_social_expenditure, 1),
    socialExp_lag2 = lag(OBS_VALUE_social_expenditure, 2)
  ) |>
  ungroup()
```

Before making any regression, we created lagged version of our variables. We believe that past investments in health sector and social protection have an impact on mortality and we want this to appear in our model. 

We will be creating lagged versions of 4 variables : mortality, health expenditure, social expenditure and hospital beds. 

Consequently we have : 

- `mortality_lag1` : first lag of the mortality variable (at time t-1)
- `mortality_lag2` : second lag of the mortality variable (at time t-2)
- `healthExp_lag1` : first lag of the health expenditure variable (at time t-1)
- `healthExp_lag2` : second lag of the health expenditure variable (at time t-2)
- `hospBeds_lag1` : first lag of the hospital Beds variable (at time t-1)
- `hospBeds_lag2` : second lag of the hospital Beds variable (at time t-2)
- `socialExp_lag1` : first lag of the social expenditure variable (at time t-1)
- `socialExp_lag2` : second lag of the social expenditure variable (at time t-2)


## Model testing


### First test

The model we first want to test is : 

\begin{equation*}
\begin{aligned}
Mortality_{i,t} =\;& \gamma_{0,i}
+ \beta_{1} \, mortality_{i,t-1}
+ \beta_{2} \, mortality_{i,t-2}
+ \beta_{3} \, health.expenditure_{i,t-1} \\[0.4em]
&+ \beta_{4} \, health.expenditure_{i,t-2}
+ \beta_{5} \, Hospital.Beds_{i,t-1} 
+ \beta_{6} \, Hospital.Beds_{i,t-2} \\[0.4em]
&+ \gamma_{7} \, GDP.per.capita_{i,t}
+ \gamma_{8} \, Unemployment_{i,t} 
+ \gamma_{9} \, HDI_{i,t} \\[0.4em]
&+ \gamma_{10} \, Life.expectancy_{i,t}
\end{aligned}
\end{equation*}



With

- i = index for country i 
- t = index for period t (here our periods are years)



We also assume that mortality (at time t-1), social expenditure and hospital beds, our explanatory variables, are fixed effects.
GDP per capita, Unemployment, Life expectancy and HDI, our control variables, are random effects (meaning that we take into account in this model the fact that they will be different for each country).


- Fixed effects have their coefficient represented by the symbol beta
- Random effects have their coefficient represented by the symbol gamma

```{r}
#| message: false
#| warning: false

library(lme4)

first_test <- lmer(OBS_VALUE_mortality ~ mortality_lag1 + mortality_lag2 + healthExp_lag1 + healthExp_lag2 + hospBeds_lag1 + hospBeds_lag2 + OBS_VALUE_gdp + OBS_VALUE_unemp + OBS_VALUE_hdi + OBS_VALUE_life_exp + (OBS_VALUE_gdp + OBS_VALUE_unemp + OBS_VALUE_hdi + OBS_VALUE_life_exp | REF_AREA),
              data = data_lagged, REML = FALSE)
summary(first_test)
```

After the first test, respecting our first model, we can see two things : 

- Firstly, having a second lag for each of the explanatory variables is not as useful to our model as we could have thought. Their coefficient are not coherent compared to variables lagged only once (`healthExp_lag1` compared to `healthExp_lag2` for example). This can be explained by the fact that there is not really a direct effect of the second lag on the explained variable and that they only affect the explained variable through their relation with the first lag. 
Moreover the coefficients between explanatory variables lagged twice and lagged once are too high, having both is unnecessary. 
Therefore we can remove second lags from our regressions.

- Secondly, when assuming this many variables have random effects (here, gdp, hdi, unemployment and life expectancy), we notice there is a lot of correlation between the variables with random effects. Especially, there is a lot of correlation between each of these variables and the intercept which is random too (to take in account structural differences between countries). 
We can conclude it is probably not relevant to have these variables as random effects.  



### Second test

After this first test, what we are going to try is to largely reduce the number of random effects, and only use one lag. The model we will use for our regression is now : 

\begin{equation*}
\begin{aligned}
Mortality_{i,t} =\;& \gamma_{0,i}
+ \beta_{1} \, mortality_{i,t-1}
+ \beta_{2} \, health.expenditure_{i,t-1} \\[0.4em]
&+ \beta_{3} \, Hospital.Beds_{i,t-1} 
+ \beta_{4} \, GDP.per.capita_{i,t}
+ \beta_{5} \, Unemployment_{i,t} \\[0.4em]
&+ \beta_{6} \, HDI_{i,t}
+ \beta_{7} \, Life.expectancy_{i,t}
\end{aligned}
\end{equation*}


```{r}
#| message: false
#| warning: false
second_test <- lmer(OBS_VALUE_mortality ~ mortality_lag1 + healthExp_lag1 + hospBeds_lag1 + OBS_VALUE_gdp + OBS_VALUE_unemp + OBS_VALUE_hdi + OBS_VALUE_life_exp + (1 | REF_AREA), data = data_lagged, REML = FALSE)
summary(second_test)
```

The results seem better and more coherent than in the first model. However we do notice that the AIC - Akaike information criterion, which is a measure for how well fitted a model is - is higher than it was in the previous model (6657.8 versus 6325.4). The AIC checks both if explanatory variables explain the observed variable correctly and for whether or not the number of parameters in the model is too high. Generally the lower the AIC is, the better the model is.
The AIC is not absolute, for example here we do see that our second model is more coherent but it encourages us to make more tests.



### Third test

For our third test model we add non lagged explanatory variables (variables at lag = 0). We will also add social expenditures which was not in the previous regression to see if it is relevant in our model (OBS_VALUE_social_expenditure and socialExp_lag1)

Our model becomes :

\begin{equation*}
\begin{aligned}
Mortality_{i,t} =\;& \gamma_{0,i}
+ \beta_{1} \, mortality_{i,t-1}
+ \beta_{2} \, social.expenditure_{i,t}
+ \beta_{3} \, social.expenditure_{i,t-1} \\[0.4em]
&+ \beta_{4} \, health.expenditure_{i,t}
+ \beta_{5} \, health.expenditure_{i,t-1}
+ \beta_{6} \, Hospital.Beds_{i,t} \\[0.4em]
&+ \beta_{7} \, Hospital.Beds_{i,t-1} 
+ \beta_{8} \, GDP.per.capita_{i,t}
+ \beta_{9} \, Unemployment_{i,t} \\[0.4em]
&+ \beta_{10} \, HDI_{i,t}
+ \beta_{11} \, Life.expectancy_{i,t}
\end{aligned}
\end{equation*}


```{r}
#| message: false
#| warning: false
third_test <- lmer(OBS_VALUE_mortality ~ mortality_lag1 + OBS_VALUE_social_expenditure + socialExp_lag1 + OBS_VALUE_health_exp + healthExp_lag1 + OBS_VALUE_hosp_beds + hospBeds_lag1 + OBS_VALUE_gdp + OBS_VALUE_unemp + OBS_VALUE_hdi + OBS_VALUE_life_exp + (1 | REF_AREA), data = data_lagged, REML = FALSE)

summary(third_test)
```

The AIC is lower in this model than it was in the second test (6495.0 vs 6657.8). However, contrary to what we could believe theoretically, social expenditures at time t and time t-1 do not have a significant impact on mortality at time t (we see that their t-value are close to 0 and not 1 in absolute value)



### Fourth test

Fourth test with an additional random effect : GDP per capita (in order to try taking into account countries' richness level)

\begin{equation*}
\begin{aligned}
Mortality_{i,t} =\;& \gamma_{0,i}
+ \beta_{1} \, mortality_{i,t-1}
+ \beta_{2} \, social.expenditure_{i,t}
+ \beta_{3} \, social.expenditure_{i,t-1} \\[0.4em]
&+ \beta_{4} \, health.expenditure_{i,t}
+ \beta_{5} \, health.expenditure_{i,t-1}
+ \beta_{6} \, Hospital.Beds_{i,t} \\[0.4em]
&+ \beta_{7} \, Hospital.Beds_{i,t-1} 
+ \gamma_{8} \, GDP.per.capita_{i,t}
+ \beta_{9} \, Unemployment_{i,t} \\[0.4em]
&+ \beta_{10} \, HDI_{i,t}
+ \beta_{11} \, Life.expectancy_{i,t}
\end{aligned}
\end{equation*}

```{r}
#| message: false
#| warning: false
fourth_test <- lmer(OBS_VALUE_mortality ~ mortality_lag1 + OBS_VALUE_social_expenditure + socialExp_lag1 + OBS_VALUE_health_exp + healthExp_lag1 + OBS_VALUE_hosp_beds + hospBeds_lag1 + OBS_VALUE_gdp + OBS_VALUE_unemp + OBS_VALUE_hdi + OBS_VALUE_life_exp + (1 + OBS_VALUE_gdp | REF_AREA), data = data_lagged, REML = FALSE)
summary(fourth_test)
```

### Fifth test

Fifth test using HDI as the additional random effect (and no longer GDP per capita) : 

\begin{equation*}
\begin{aligned}
Mortality_{i,t} =\;& \gamma_{0,i}
+ \beta_{1} \, mortality_{i,t-1}
+ \beta_{2} \, social.expenditure_{i,t}
+ \beta_{3} \, social.expenditure_{i,t-1} \\[0.4em]
&+ \beta_{4} \, health.expenditure_{i,t}
+ \beta_{5} \, health.expenditure_{i,t-1}
+ \beta_{6} \, Hospital.Beds_{i,t} \\[0.4em]
&+ \beta_{7} \, Hospital.Beds_{i,t-1} 
+ \beta_{8} \, GDP.per.capita_{i,t}
+ \beta_{9} \, Unemployment_{i,t} \\[0.4em]
&+ \gamma_{10} \, HDI_{i,t}
+ \beta_{11} \, Life.expectancy_{i,t}
\end{aligned}
\end{equation*}

```{r}
#| message: false
#| warning: false
fifth_test <- lmer(OBS_VALUE_mortality ~ mortality_lag1 + OBS_VALUE_social_expenditure + socialExp_lag1 + OBS_VALUE_health_exp + healthExp_lag1 + OBS_VALUE_hosp_beds + hospBeds_lag1 + OBS_VALUE_gdp + OBS_VALUE_unemp + OBS_VALUE_hdi + OBS_VALUE_life_exp + (1 + OBS_VALUE_hdi | REF_AREA), data = data_lagged, REML = FALSE)
summary(fifth_test)
```


### Sixth

Sixth test using both GDP and HDI as additional random effects : 

\begin{equation*}
\begin{aligned}
Mortality_{i,t} =\;& \gamma_{0,i}
+ \beta_{1} \, mortality_{i,t-1}
+ \beta_{2} \, social.expenditure_{i,t}
+ \beta_{3} \, social.expenditure_{i,t-1} \\[0.4em]
&+ \beta_{4} \, health.expenditure_{i,t}
+ \beta_{5} \, health.expenditure_{i,t-1}
+ \beta_{6} \, Hospital.Beds_{i,t} \\[0.4em]
&+ \beta_{7} \, Hospital.Beds_{i,t-1} 
+ \gamma_{8} \, GDP.per.capita_{i,t}
+ \beta_{9} \, Unemployment_{i,t} \\[0.4em]
&+ \gamma_{10} \, HDI_{i,t}
+ \beta_{11} \, Life.expectancy_{i,t}
\end{aligned}
\end{equation*}


```{r}
#| message: false
#| warning: false
sixth_test <- lmer(OBS_VALUE_mortality ~ mortality_lag1 + OBS_VALUE_social_expenditure + socialExp_lag1 + OBS_VALUE_health_exp + healthExp_lag1 + OBS_VALUE_hosp_beds + hospBeds_lag1 + OBS_VALUE_gdp + OBS_VALUE_unemp + OBS_VALUE_hdi + OBS_VALUE_life_exp + (1 + OBS_VALUE_hdi + OBS_VALUE_gdp | REF_AREA), data = data_lagged, REML = FALSE)
summary(sixth_test)
```

Tests four to six helped us notice that : 

- GDP and HDI were not varying enough to be random effects. Since we already have a moving intercept and there is not much of a difference between having a moving intercept from one country to another and having a random effect for GDP and HDI per country)
Particularly having a random effect for HDI is not great since it has a perfect correlation (-1) with the intercept, meaning that having HDI as a random effect would be useless. We see the same thing with GDP but at a lower level since the correlation is slightly less high.  
- Health expenditure at present time and t-1 are relevant in the regression
- Social expenditure not so much (they still have a t value closer to 0 than 1 in absolute value). However it is interesting to keep this variable in our model since it is different from what we were expecting
- The Hospital beds variable is barely relevant (0.8)
- Control variables are really relevant (especially life expectancy)


We also notice that the fifth test (which is not that great since it has correlation problems) has the lowest AIC. We were able to find a lower AIC but it ended up not being a coherent model. 
Consequently we will have to compromise by choosing a more coherent model with a slightly higher AIC. 


### Chosen model

The best model we were able to find ended up being our third test. 

So our chosen model is : 

\begin{equation*}
\begin{aligned}
Mortality_{i,t} =\;& \gamma_{0,i}
+ \beta_{1} \, mortality_{i,t-1}
+ \beta_{2} \, social.expenditure_{i,t}
+ \beta_{3} \, social.expenditure_{i,t-1} \\[0.4em]
&+ \beta_{4} \, health.expenditure_{i,t}
+ \beta_{5} \, health.expenditure_{i,t-1}
+ \beta_{6} \, Hospital.Beds_{i,t} \\[0.4em]
&+ \beta_{7} \, Hospital.Beds_{i,t-1} 
+ \beta_{8} \, GDP.per.capita_{i,t}
+ \beta_{9} \, Unemployment_{i,t} \\[0.4em]
&+ \beta_{10} \, HDI_{i,t}
+ \beta_{11} \, Life.expectancy_{i,t}
\end{aligned}
\end{equation*}


```{r}
model <- lmer(OBS_VALUE_mortality ~ mortality_lag1 + OBS_VALUE_social_expenditure + socialExp_lag1 + OBS_VALUE_health_exp + healthExp_lag1 + OBS_VALUE_hosp_beds + hospBeds_lag1 + OBS_VALUE_gdp + OBS_VALUE_unemp + OBS_VALUE_hdi + OBS_VALUE_life_exp + (1 | REF_AREA), data = data_lagged, REML = FALSE)

summary(model)
```

