---
title: "Phase3"
author: "Karla Otoude and Chloé Marquis"
format:
  pdf: default
execute:
  echo: false
  warning: false
  message: false
---

# Link to our github project 
[Our Github Project](https://github.com/chloemrq/Project-Data-Management)

# I. Research question 
**How does the level of social protection impact the general population health ?** 

We want to identify if a stronger social and health protection (quantified by different variables such as health expenditure, tax revenues, etc) has an impact on the avoidable mortality rate. In order to do so we will analyse data collected in OECD countries from 2000 to 2023. 

There are two goals in our analysis :
The first is to understand the global evolution of the data and the reasons behind its trends.
The second is to study the Covid-19 crisis. We believe it revealed how necessary having a proper social protection is to limit the number of deaths during a pandemic. 


## Method 
To conduct our study we will be using a **linear mixed model (LMM)** with lags. Such a model will allow us to properly study the OECD countries taking into account their differences. It also a fitting model since we are working with time-based data. 

Considering our research question, we will use multiple datasets and variables.

For explanatory variables, in order to estimate the strength and quality of a country’s health protection scheme, we will have : 
- Health expenditure 
- Social expenditure aggregates
- Number of hospitals beds 

We also have more general variables such as :
- GDP per capita 
- Unemployment rate 
- Human development index 
- Life expectancy
They will be used as control variables, since richer countries tend to have better living conditions which may lead to a generally healthier population, without the need for a strong health protection. 

Finally, the explained variable will be : 
- Avoidable mortality 
It will be used to estimate the population’s general health. 

 
```{r}
# Loading the packages
library(here)
here::i_am("Project-Data-Management.Rproj")
```


```{r}
library(ggplot2)
library(dplyr)
library(tidyr)
library(vroom)
library(readxl)
library(lme4)
```

# II. Description of the datasets
This report relies on 8 datasets. Here is a short description of each of them. More details on the datasets and their descriptive statistics can be found in Phase 2.

#### Health expenditure - OECD (2025)
This dataset details the annual health expenditure and financing as a percentage of GDP for 52 countries. The data is available for a period ranging from 2000 to 2024. It was computed using financial flows related to the consumption of healthcare goods and services from different health providers such as Hospitals or Residential long-term care facilities.  

### Avoidable mortality - OECD (2025)
This dataset describes the number of "avoidable deaths" per 100,000 inhabitants annually for the period 2000-2024 for 46 countries. It contains contains both “preventable mortality” and “treatable (or amenable) mortality”. The first refers to deaths that can be avoided through effective public health and primary prevention interventions. The second refers to timely and effective health care interventions, including prevention and treatment.Both indicators refer to premature mortality (under age 75).

### GDP per Capita - World Bank (2024)
The GDP per Capita dataset presents the GDP per capita (constant 2015 US$) from 1960 to 2024 for 70 countries. This indicator is expressed in constant prices, meaning the series has been adjusted to account for price changes over time. The reference year for this adjustment is 2015. This indicator is expressed in United States dollars. 

### Hospital beds - OECD (2025)
This dataset provides data on the number of total hospitals beds by function of healthcare and by type of care (ie. somatic or psychiatric care) for the period 2000-2024 for 48 different countries. Total hospital beds are the sum of the following categories:
Curative care (acute care) beds in hospitals, Rehabilitative care beds in hospitals, Long-term care beds in hospitals, All other beds in hospitals not elsewhere classified. 

### Life expectancy - World Bank (2023)
This dataset provides the life expectancy in years for women and men for a period ranging from 1960 to 2023, for 69 different countries or economies. 

### Social Expenditure Aggregate - OECD (2025)
This dataset includes internationally comparable statistics on public and mandatory and voluntary private social expenditure at programme level (e.g. Old age, Survivors, Incapacity-related benefits, Health, etc) It covers 38 OECD countries and some accession countries for the period 1980-2021/23 and estimates for aggregates for 2022-24.

### Unemployement Rate - IMF (2025)
This IMF dataset describes the percentage of the labor force that is unemployed and actively seeking employment. It is available from 1980 to 2025 and features 120 geographic regions. 

### HDI (Human Development Index) - UNDP (2025)
This dataset describes the human development index, per country (195), annually (1990-2023). It is a summary measure of average achievement in key dimensions of human development: a long and healthy life, being knowledgeable and having a decent standard of living. The HDI is between 0 (low human development) and 1 (very high human development).




```{r}
# Loading the cleaned dataset from phase 2
database <- vroom(here("data", "cleaned_database.csv"))
```


```{r}
# Loading the raw datasets to create a brief description table
health_expenditure <- vroom(here("data", "OECD.ELS.HD,DSD_SHA@DF_SHA,1.0+.A.EXP_HEALTH.PT_B1GQ._T.._T.._T....csv"))

avoidable_mortality <- vroom(here("data", "OECD.ELS.HD,DSD_HEALTH_STAT@DF_AM,1.1+.A.AVM.DT_10P5HB.._T........csv"))

gdp_per_capita <- vroom(
  here("data/API_NY.GDP.PCAP.KD_DS2_en_csv_v2_242568", "API_NY.GDP.PCAP.KD_DS2_en_csv_v2_242568.csv"),
  delim = ",",
  skip = 4,           # need to skip the first 4 rows
  col_names = TRUE,   
)

hospital_beds <- vroom(here("data", "OECD.ELS.HD,DSD_HEALTH_REAC_HOSP@DF_BEDS_FUNC,1.0+..BD..._T._T...csv"))

life_expectancy <- vroom(
  here("data/API_SP.DYN.LE00.IN_DS2_fr_csv_v2_11258", "API_SP.DYN.LE00.IN_DS2_fr_csv_v2_11258.csv"), 
  delim = ",",
  skip = 4,           # need to skip the first 4 rows
  col_names = TRUE)

social_expenditure <- vroom(here("data","OECD.ELS.SPD,DSD_SOCX_AGG@DF_SOCX_AGG,1.0PT_B1GQ.ES10._T.csv"))

unemployment <- vroom(here("data", "dataset_2025-11-21T14_31_58.442440069Z_DEFAULT_INTEGRATION_IMF.RES_WEO_9.0.0.csv"))

hdi <- read_excel("data/hdr-data.xlsx")
```


```{r}
# Description table 
data_sets <- list(
  list(name = "Health Expenditure", data = health_expenditure),
  list(name = "Avoidable Mortality", data = avoidable_mortality),
  list(name = "GDP per Capita", data = gdp_per_capita),
  list(name = "Number of Hospital Beds", data = hospital_beds),
  list(name = "Life Expectancy", data = life_expectancy),
  list(name = "Social Expenditure", data = social_expenditure),
  list(name = "Unemployement", data = unemployment),
  list(name = "HDI", data = hdi)
)

get_summary <- function(dataset) {
  data <- dataset$data
  dataset_name <- dataset$name

  data.frame(
    Dataset = dataset_name,
    Observations = nrow(data),
    Variables = ncol(data)
  )
}

# Apply to all datasets
summary_list <- lapply(data_sets, get_summary)
summary_table <- do.call(rbind, summary_list)

# Display the table
knitr::kable(summary_table, caption = "Brief summary of the datasets used in this report")
```

## Description of the merged and cleaned dataset 
```{r}
database |> 
  summarise("Number of rows" = n(), 
            "Number of columns" = ncol(database),
            "Percentage of NA" = paste0(round(sum(is.na(database)) / (n() * ncol(database)) * 100, 2), "%"),
            "Number of countries studied" = n_distinct(REF_AREA), 
            "Time period" = paste0(min(TIME_PERIOD), "-", max(TIME_PERIOD))) |> 
  as.data.frame() |>
  knitr::kable()
```


# 3. Data Analysis 
*Graphical representation of our main variable : avoidable mortality (OBS_VALUE_mortality)*


### Global avoidable mortality
First we can take a look at the number of avoidable deaths globally
```{r}
database |>
  group_by(TIME_PERIOD) |>
  summarise(mean_mortality = mean(OBS_VALUE_mortality, na.rm = TRUE)) |>
  ggplot(aes(x = TIME_PERIOD, y = mean_mortality)) +
  geom_line() +
  geom_point() +
  labs(
    title = "Average avoidable mortality in the world (2000-2023), per 100,000 inhabitants annually",
    y = "Number of avoidable deaths",
    x = "Year")
```
This graph reveals a downward trend in avoidable mortality from 2000 to 2019 cut by a sudden increase in 2020 and 2021 during Covid-19. However it seems that, afterward, the variable will go back to its previous trend.


### Avoidable mortality per country
We also check the `avoidable_mortality` variable per country. 
```{r}
average_trend <- database |>
  group_by(TIME_PERIOD) |>
  summarise(mean_mortality = mean(OBS_VALUE_mortality, na.rm = TRUE))

database |>
  ggplot(aes(x = TIME_PERIOD, y = OBS_VALUE_mortality, color=REF_AREA)) +
  geom_line() +
  geom_line(
    data = average_trend,
    aes(x = TIME_PERIOD, y = mean_mortality, color="OECD average"),
    color = "red",
    linewidth = 1.3
  ) +
  scale_x_continuous(breaks = c(2000, 2010, 2020)) +
  labs(
    x = "Year",
    y = "Number of avoidable deaths",
    caption = "Red line: OECD average",
    title = "Avoidable mortality per country (2000-2023), per 100,000 inhabitants annually")
```
Most countries share the same downward sloping trend in avoidable mortality. A distinct increase appears in 2019, with a peak in 2020 and a decrease to previous trend values from 2021 in all countries. 
The country with the lowest avoidable death rate is Switzerland (CHE) and the highest is Latvia at the beginning of the 2000s, then surpassed by Lithuania (LTU) around 2007. We must also notice the increase in avoidable deaths from around 400 to almost 650 per 100,000 inhabitants in Mexico in 2019. 

It is important to note that we this report primarily studies developed countries with the most available data from 2000 to 2023. We chose to exclude the following countries : South Africa (ZAF), Argentina (ARG), Peru (PER), Thailand (THA) and Brazil (BRA) as the data is not sufficient to proceed with proper data analysis. Thus, our conclusions will be biased due to the fact that we study more developed countries with, perhaps, more similar institutional structures and resistance to global health crises such as Covid-19. 

### Visualising *avoidable_mortality* against independent variables
The goal of our analysis is to determine if certain variables explain the level of avoidable mortality. We can start the data analysis by simply plotting some independent variables against *avoidable_mortality* and observe the general trend. 

```{r}
ggplot(database, aes(x = OBS_VALUE_health_exp, y = OBS_VALUE_mortality)) +
  geom_point(aes(color = REF_AREA)) +
  theme(legend.position = "right") +
  labs(title = "Avoidable mortality against Health Expenditure") +
  geom_smooth(method = "lm", se = FALSE) 
```

As expected, as the level of health expenditure increases, avoidable mortality tends to decrease. Australia (AUS) detaches itself from other countries by having a particularly high level of health expenditure, but still a moderately high level of avoidable mortality. Most countries are situated on the left side of the graph (with low health expenditure) showcasing both countries with high and low rates of avoidable mortality for the same level of health expenditure. 

```{r}
ggplot(database, aes(x = OBS_VALUE_unemp, y = OBS_VALUE_mortality)) +
  geom_point(aes(color = REF_AREA)) +
  theme(legend.position = "none") +
  labs(title = "Avoidable mortality against Unemployment") +
  geom_smooth(method = "lm", se = FALSE)
```
Here, the trend indicates that as unemployment increases, avoidable mortality does too. Most countries have low levels of unemployment and low rates of avoidable mortality. 
In the bottom right, Spain (ESP) and Greece (GRC) display very high rates of unemployment while keeping their avoidable mortality rates among the lowest of all countries. On the contrary, countries such as Mexico (MEX) in purple showcase high levels of avoidable mortality with very low rates of unemployment. 

```{r}
ggplot(database, aes(x = OBS_VALUE_gdp, y = OBS_VALUE_mortality)) +
  geom_point(aes(color = REF_AREA)) +
  theme(legend.position = "none") +
  labs(title = "Avoidable mortality against GDP per Capita") +
  geom_smooth(method = "lm", se = FALSE)
```
This graph suggests that as GDP per capita increases, the rate of avoidable mortality decreases. The avoidable mortality rate doesn't seem to go below 100 deaths per 100,000 inhabitants. Thus, as GDP per capita increases, avoidable mortality remains between 100 and 300 deaths per 100,000 inhabitants suggesting marginal change in mortality as a country's population becomes richer.

```{r}
ggplot(database, aes(x = OBS_VALUE_life_exp, y = OBS_VALUE_mortality)) +
  geom_point(aes(color = REF_AREA)) +
  theme(legend.position = "none") +
  labs(title = "Avoidable mortality against Life Expectancy") +
  geom_smooth(method = "lm", se = FALSE)
```
The correlation between avoidable mortality and life expectancy seems strong in this graph. Indeed, as life expectancy increases, avoidable mortality decreases linearly for all countries. Two countries (Türkiye (TUR) in pink and Colombia (COL) in brown) find themselves slightly below the trend line, with lower mortality than the trend would suggest for their level of life expectancy. 

# 4. Econometric Analysis : Linear Mixed Model (LMM)


## Creating lag operators/ lagged variables

```{r}
data_lagged <- database |>
  group_by(REF_AREA) |>
  arrange(TIME_PERIOD) |>
  mutate(
    mortality_lag1 = lag(OBS_VALUE_mortality, 1),
    mortality_lag2 = lag(OBS_VALUE_mortality, 2),
    healthExp_lag1 = lag(OBS_VALUE_health_exp, 1),
    healthExp_lag2 = lag(OBS_VALUE_health_exp, 2),
    hospBeds_lag1 = lag(OBS_VALUE_hosp_beds, 1),
    hospBeds_lag2 = lag(OBS_VALUE_hosp_beds, 2),
    socialExp_lag1 = lag(OBS_VALUE_social_expenditure, 1),
    socialExp_lag2 = lag(OBS_VALUE_social_expenditure, 2)
  ) |>
  ungroup()
```
Before making any regression, we created lagged version of our variables. We believe that past investments in health sector and social protection have an impact on mortality and we want this to appear in our model. 

We will be creating lagged versions of 4 variables : mortality, health expenditure, social expenditure and hospital beds. Consequently we have : 
- `mortality_lag1` : first lag of the mortality variable (at time t-1)
- `mortality_lag2` : second lag of the mortality variable (at time t-2)
- `healthExp_lag1` : first lag of the health expenditure variable (at time t-1)
- `healthExp_lag2` : second lag of the health expenditure variable (at time t-2)
- `hospBeds_lag1` : first lag of the hospital Beds variable (at time t-1)
- `hospBeds_lag2` : second lag of the hospital Beds variable (at time t-2)
- `socialExp_lag1` : first lag of the social expenditure variable (at time t-1)
- `socialExp_lag2` : second lag of the social expenditure variable (at time t-2)


